<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard | ketenangan jiwa</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="css/admin_preview.css" />
  <link rel="icon" type="image/png" href="images/logo.png" />

  <style>
    :root {
      --bg: #0b1624;
      --panel: #0f192b;
      --border: #1f2b3e;
      --text: #e6edf5;
      --muted: #9cb1c7;
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --success: #22c55e;
      --success-dark: #16a34a;
      --card: #111c2f;
      --highlight: rgba(59,130,246,0.1);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    }
    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Poppins', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0b1624 0%, #0f192b 100%);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      background: rgba(9, 14, 25, 0.9);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }
    .brand {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 1.2rem;
      letter-spacing: 0.5px;
      color: var(--text);
      text-decoration: none;
      transition: opacity 0.2s;
    }
    .brand:hover {
      opacity: 0.8;
    }
    .brand img { 
      width: 40px; 
      height: 40px; 
      object-fit: contain; 
      border-radius: 8px;
      box-shadow: var(--shadow);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-lg);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .panel:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }
    h1, h2, h3 { 
      margin: 0 0 16px; 
      font-weight: 600;
    }
    h1 { font-size: 1.8rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.2rem; }
    .muted { 
      color: var(--muted);
      font-size: 0.9rem;
    }
    .flex { 
      display: flex; 
      gap: 12px; 
      align-items: center;
      flex-wrap: wrap;
    }
    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button, input, select, textarea {
      font-family: inherit;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(12, 21, 37, 0.7);
      color: var(--text);
      padding: 12px 16px;
      transition: all 0.2s;
    }
    button {
      cursor: pointer;
      border: none;
      background: var(--primary);
      color: white;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.2s;
      box-shadow: var(--shadow);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    button:hover { 
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled { 
      opacity: 0.5; 
      cursor: not-allowed; 
      transform: none; 
    }
    .danger { 
      background: var(--danger); 
      color: #fff; 
      box-shadow: var(--shadow);
    }
    .danger:hover {
      background: var(--danger-dark);
    }
    .outline { 
      background: transparent; 
      color: var(--text); 
      border: 1px solid var(--border); 
      box-shadow: none;
    }
    .outline:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    form .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    label { 
      display: block; 
      font-weight: 600; 
      margin-bottom: 8px;
      color: var(--text);
      font-size: 0.9rem;
    }
    input, select, textarea {
      width: 100%;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    textarea { 
      min-height: 100px; 
      resize: vertical;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 16px;
    }
    .table th, .table td {
      padding: 12px;
      border-bottom: 1px solid var(--border);
      text-align: left;
      vertical-align: middle;
    }
    .table th {
      background: rgba(31, 43, 62, 0.5);
      font-weight: 600;
      color: var(--text);
    }
    .table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    .badge { 
      padding: 4px 10px; 
      border-radius: 999px; 
      font-size: 12px; 
      font-weight: 600;
      display: inline-block;
    }
    .badge.green { 
      background: rgba(34,197,94,0.2); 
      color: #4ade80; 
    }
    .badge.yellow {
      background: rgba(234,179,8,0.2);
      color: #fbbf24;
    }
    .badge.red {
      background: rgba(248,113,113,0.2);
      color: #f87171;
    }
    .badge.gray { 
      background: rgba(148,163,184,0.2); 
      color: #cbd5e1; 
    }
    .badge.blue {
      background: rgba(59,130,246,0.2);
      color: #60a5fa;
    }

    .stats-panel {
      padding: 18px 24px;
      background: linear-gradient(160deg, rgba(59,130,246,0.08), rgba(15,23,42,0.85));
      box-shadow: var(--shadow-lg);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .stat-card {
      background: rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .stat-label {
      display: block;
      font-size: 0.85rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .stat-value {
      margin: 8px 0;
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--text);
    }
    .stats-filter {
      display: flex;
      flex-direction: column;
      font-size: 0.85rem;
      color: var(--muted);
    }
    .stats-filter label {
      margin-bottom: 4px;
      font-size: 0.75rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
    }
    .stats-filter select {
      background: rgba(15, 25, 43, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 14px;
      min-width: 180px;
    }
    .stat-status-list {
      list-style: none;
      margin: 18px 0 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .stat-status-list li {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      color: var(--text);
      background: rgba(255,255,255,0.06);
      border-radius: 999px;
      padding: 8px 14px;
      border: 1px solid rgba(255,255,255,0.12);
    }
    .stat-status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      background: var(--muted);
    }
    .stat-updated {
      margin-top: 12px;
      font-size: 0.9rem;
    }

    .status-text { 
      font-size: 14px; 
    }
    .pill {
      padding: 8px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .preview {
      width: 100%;
      max-width: 320px;
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
      background: var(--card);
      box-shadow: var(--shadow-lg);
    }
    .preview img { 
      display: block; 
      width: 100%; 
      height: auto; 
    }
    .hidden { 
      display: none !important; 
    }
    
    /* Custom styles for admin layout */
    .admin-layout {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 24px;
    }
    
    /* Preview Card Styles */
    .preview-card {
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      position: sticky;
      top: 100px;
    }
    .preview-media {
      position: relative;
      height: 200px;
      overflow: hidden;
    }
    .preview-media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .preview-chip {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }
    .preview-body {
      padding: 20px;
    }
    .preview-title {
      font-size: 1.2rem;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .preview-tagline {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 16px;
    }
    .preview-meta {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .preview-meta li {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    .preview-meta i {
      width: 16px;
      color: var(--primary);
    }
    .preview-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-top: 1px solid var(--border);
    }
    .preview-price {
      font-weight: 600;
      color: var(--success);
    }
    .preview-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    .preview-btn:hover {
      background: var(--primary-dark);
    }
    
    /* Form Actions */
    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }
    
    /* Table Actions */
    .table-actions {
      display: flex;
      gap: 8px;
    }
    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }
    
    /* Status Indicators */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    .status-dot.green {
      background: var(--success);
    }
    .status-dot.gray {
      background: var(--muted);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .admin-layout {
        grid-template-columns: 1fr;
      }
      .preview-card {
        position: static;
        margin-top: 24px;
      }
    }
    
    @media (max-width: 720px) {
      header { 
        flex-direction: column; 
        align-items: flex-start; 
        gap: 12px; 
      }
      .container { 
        padding: 16px; 
      }
      .form .grid {
        grid-template-columns: 1fr;
      }
      .table {
        font-size: 12px;
      }
      .table th, .table td {
        padding: 8px;
      }
      .btn-icon {
        width: 28px;
        height: 28px;
      }
    }
  </style>
</head>
<body>
  <header>
    <a href="#" class="brand">
      <img src="images/logo.png" alt="ketenangan jiwa" />
      <span>ketenangan jiwa â€¢ Admin</span>
    </a>
    <div class="flex">
      <span id="userInfo" class="pill muted">Belum login</span>
      <button id="loginBtn"><i class="fa-brands fa-google"></i> Login</button>
      <button id="logoutBtn" class="outline hidden">Logout</button>
    </div>
  </header>

  <div class="container">
    <div id="guardPanel" class="panel">
      <h2>Status Akses</h2>
      <p id="guardMessage" class="muted">Memeriksa sesi...</p>
    </div>

    <div id="dashboard" class="hidden">
      <!-- PANEL STATISTIK -->
      <div class="panel stats-panel">
        <div class="flex-between" style="gap: 12px; flex-wrap: wrap; align-items: center;">
          <div>
            <h2>Statistik Pesanan</h2>
            <p class="muted">Pantau pendapatan, status order, dan estimasi peserta.</p>
          </div>
          <div class="stats-filter">
            <label for="statEventFilter">Event</label>
            <select id="statEventFilter">
              <option value="">Semua event</option>
            </select>
          </div>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <p class="stat-label">Pendapatan (paid)</p>
            <p class="stat-value" id="statRevenue">Rp 0</p>
            <p class="muted">Total tagihan yang sudah lunas.</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">Pesanan berstatus paid</p>
            <p class="stat-value" id="statPaidCount">0</p>
            <p class="muted">Order yang sudah diverifikasi pembayaran.</p>
          </div>
          <div class="stat-card">
            <p class="stat-label">Peserta terdaftar</p>
            <p class="stat-value" id="statParticipantCount">0</p>
            <p class="muted">Jumlah tiket/kuota yang terisi.</p>
          </div>
        </div>
        <ul class="stat-status-list" id="statStatusList">
          <li class="muted">Menunggu data transaksi...</li>
        </ul>
        <p class="muted stat-updated" id="statUpdatedAt">Terakhir diperbarui: -</p>
      </div>

      <!-- PANEL KETERANGAN KELOLA EVENT -->
      <div class="panel" id="kelolaEventPanel">
        <div class="flex-between" style="gap: 12px; flex-wrap: wrap; align-items: center;">
          <div>
            <h2>Kelola Event</h2>
            <p class="muted">Tambah/edit event, upload poster Cloudinary, lalu simpan ke Firestore.</p>
          </div>
          <div class="flex" style="gap: 8px; align-items: center; flex-wrap: wrap;">
            <div class="status-text">
              <span id="adminStatus" class="badge gray">checking</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PANEL FORM EVENT + PREVIEW -->
      <div class="panel">
        <div class="admin-layout">
          <form id="eventForm">
            <div class="grid">
              <div>
                <label>Judul</label>
                <input name="title" type="text" placeholder="Judul event" required />
              </div>
              <div>
                <label>Slug (unik)</label>
                <input name="slug" type="text" placeholder="kajian-tafsir-al-baqarah" required />
              </div>
              <div>
                <label>Kategori</label>
                <input name="category" type="text" placeholder="Tafsir / Fiqih / dll" />
              </div>
              <div>
                <label>Status</label>
                <select name="status">
                  <option value="draft">Draft</option>
                  <option value="published">Published</option>
                </select>
              </div>
              <div>
                <label>Tanggal</label>
                <input name="schedule" type="text" placeholder="Sabtu, 8 Nov 2025" />
              </div>
              <div>
                <label>Waktu</label>
                <input name="time" type="text" placeholder="19:00 - 21:00 WIB" />
              </div>
              <div>
                <label>Lokasi</label>
                <input name="location" type="text" placeholder="Masjid / Aula" />
              </div>
              <div>
                <label>Alamat lengkap</label>
                <input name="address" type="text" placeholder="Jl. ..." />
              </div>
              <div>
                <label>Pemateri</label>
                <input name="speaker" type="text" placeholder="Nama ustadz/ustadzah" />
              </div>
              <div>
                <label>Harga (0 untuk gratis)</label>
                <input name="amount" type="number" min="0" step="1000" value="0" />
              </div>
              <div>
                <label>Kapasitas (opsional)</label>
                <input name="capacity" type="number" min="0" step="1" />
              </div>
              <div>
                <label>Tagline singkat</label>
                <input name="tagline" type="text" placeholder="Kalimat singkat promosi" />
              </div>
            </div>

            <div class="grid" style="margin-top:20px;">
              <div>
                <label>Deskripsi</label>
                <textarea name="description" placeholder="Deskripsi event"></textarea>
              </div>
              <div>
                <label>Highlight (pisah baris)</label>
                <textarea name="highlights" placeholder="Poin highlight, satu per baris"></textarea>
              </div>
            </div>

            <div class="grid" style="margin-top:20px;">
              <div>
                <label>Agenda (format: 08:30 - registrasi)</label>
                <textarea name="agenda" placeholder="08:30 - Registrasi&#10;09:00 - Sesi 1: ..."></textarea>
              </div>
              <div>
                <label>Catatan (pisah baris)</label>
                <textarea name="notes" placeholder="Catatan untuk peserta"></textarea>
              </div>
              <div>
                <label>Persiapan (pisah baris)</label>
                <textarea name="preparation" placeholder="Persiapan peserta"></textarea>
              </div>
              <div>
                <label>Poster URL</label>
                <input name="imageUrl" type="text" placeholder="Hasil upload Cloudinary" />
                <div class="flex" style="margin-top:12px;">
                  <button type="button" id="uploadPosterBtn" class="outline">
                    <i class="fa-regular fa-image"></i> Upload/Ganti Poster
                  </button>
                  <div class="preview hidden" id="posterPreview"></div>
                </div>
              </div>
            </div>

            <div class="grid" style="margin-top:20px;">
              <div>
                <label>Kontak WA</label>
                <input name="contactWa" type="text" placeholder="https://wa.me/62..." />
              </div>
              <div>
                <label>Kontak Telepon</label>
                <input name="contactPhone" type="text" placeholder="08xx" />
              </div>
              <div>
                <label>Kontak Email</label>
                <input name="contactEmail" type="email" placeholder="panitia@contoh.com" />
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" id="saveBtn"><i class="fa-regular fa-floppy-disk"></i> Simpan</button>
              <button type="button" id="resetBtn" class="outline">Reset Form</button>
              <span id="formStatus" class="muted"></span>
            </div>
          </form>

          <div>
            <div class="preview-card" id="livePreview">
              <div class="preview-media">
                <img id="previewImage" src="./images/placeholder.jpg" alt="Poster event">
                <span class="preview-chip" id="previewCategory">Kategori</span>
              </div>
              <div class="preview-body">
                <h3 class="preview-title" id="previewTitle">Judul Event</h3>
                <p class="preview-tagline" id="previewTagline">Tagline atau deskripsi singkat.</p>
                <ul class="preview-meta">
                  <li><i class="fa-regular fa-calendar-days"></i><span id="previewSchedule">Tanggal & waktu</span></li>
                  <li><i class="fa-solid fa-location-dot"></i><span id="previewLocation">Lokasi</span></li>
                  <li><i class="fa-regular fa-user"></i><span id="previewSpeaker">Pemateri</span></li>
                </ul>
              </div>
              <div class="preview-footer">
                <span class="preview-price" id="previewPrice">Gratis</span>
                <button class="preview-btn" type="button">Daftar</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PANEL DAFTAR EVENT -->
      <div class="panel">
        <div class="flex-between">
          <h3>Daftar Event</h3>
          <div class="flex">
            <button id="newEventBtn" class="outline"><i class="fa-solid fa-plus"></i> Event Baru</button>
            <button id="refreshBtn" class="outline"><i class="fa-solid fa-rotate"></i> Refresh</button>
          </div>
        </div>
        <div style="overflow-x:auto;">
          <table class="table" id="eventsTable">
            <thead>
              <tr>
                <th>Judul</th>
                <th>Slug</th>
                <th>Status</th>
                <th>Tanggal</th>
                <th>Lokasi</th>
                <th>Harga</th>
                <th>Kuota</th>
                <th>Poster</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- PANEL TRANSAKSI + QR (VERSI 1) -->
      <div class="panel">
        <div class="flex-between">
          <h3>Transaksi</h3>

          <!-- FILTER BAR -->
          <div class="flex" style="gap: 8px; align-items: center; flex-wrap: wrap;">

            <select id="orderStatusFilter" style="min-width: 180px;">
              <option value="">Semua status</option>
              <option value="paid">Paid</option>
              <option value="pending">Pending/Unpaid</option>
              <option value="expired">Expired</option>
              <option value="failed">Failed</option>
              <option value="canceled">Canceled</option>
              <option value="refunded">Refunded</option>
            </select>

            <select id="orderEventFilter" style="min-width: 200px;">
              <option value="">Semua event</option>
            </select>

            <input id="orderSearch" type="text"
                   placeholder="Cari ref/email"
                   style="width: 220px;" />

            <button id="toggleQrPanel" class="outline">
              <i class="fa-solid fa-qrcode"></i> Scan QR
            </button>

            <button id="qrStopBtn" class="outline">
              Stop kamera
            </button>

            <button id="refreshOrdersBtn" class="outline">
              <i class="fa-solid fa-rotate"></i> Refresh
            </button>

          </div>
        </div>

        <!-- QR PANEL DI BAWAH FILTER -->
        <div id="qrPanel" class="hidden" style="margin-top: 12px; display: grid; gap: 8px;">
          <p id="qrStatus" class="muted" style="margin:0;">Scan QR tiket untuk verifikasi check-in.</p>

          <div id="qrReader"
               style="width: 100%; max-width: 440px; margin: 0 auto;
                      border: 1px solid var(--border); border-radius: 12px; overflow: hidden;">
          </div>

          <div class="flex" style="gap: 8px; flex-wrap: wrap;">
            <input id="qrInput" type="text"
                   placeholder="Kode ref / merchantRef"
                   style="flex: 1; min-width: 200px;" />
            <button id="qrSubmitBtn" class="outline">Verifikasi kode</button>
          </div>
        </div>

        <!-- TABEL TRANSAKSI -->
        <div style="overflow-x:auto; margin-top: 16px;">
          <table class="table" id="ordersTable">
            <thead>
              <tr>
                <th>Ref</th>
                <th>Event</th>
                <th>Customer</th>
                <th>Metode</th>
                <th>Status</th>
                <th>Check-in</th>
                <th>Total</th>
                <th>Dibuat</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="8" class="muted">Belum ada data.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="flex-between" style="margin-top:12px; gap: 12px;">
          <div id="ordersStatus" class="muted">-</div>
          <button id="loadMoreOrders" class="outline">Muat lebih</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://widget.cloudinary.com/v2.0/global/all.js" async></script>
  <script src="js/vendor/html5-qrcode.min.js"></script>
  <script type="module" src="js/admin.js"></script>
</body>
</html>

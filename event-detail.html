<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Detail Event | ketenangan jiwa</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.cdnfonts.com/css/coolvetica">
  <link href="https://fonts.googleapis.com/css2?family=Pacifico:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="icon" type="image/png" href="images/logokj.png" />
  
  <link rel="stylesheet" href="css/home_page.css" />
  <link rel="stylesheet" href="css/event_detail.css" />
</head>
<body>
  
  <div id="auth-gate" class="auth-gate hidden" style="display: none;"></div>

  <header class="site-header pb-3">
    <div class="container nav nav-shell">
      <div class="nav-left">
        <button class="nav-burger" id="menuOpen"><span></span><span></span><span></span></button>
      </div>
      <a class="brand brand-center" href="index.html#beranda"><img src="images/logo.png" alt="logo" /></a>
      <div class="nav-right">
        <button class="icon-btn cart-btn" id="cartToggle"><img src="images/Cart.png" alt="Cart"></button>
        <button class="icon-btn profile-btn" id="profileBtn"><img src="images/Profile.png" alt="Profile"></button>
        <div id="profileDropdown" class="profile-dropdown hidden"></div>
      </div>
    </div>
  </header>

  <div id="menuOverlay" class="menu-overlay">
    <div class="menu-panel">
        <button class="overlay-close" id="menuClose">&times;</button>
        <ul class="menu-list">
            <li><a href="index.html#beranda">Home</a></li>
            <li><a href="index.html#event">Event</a></li>
            <li><a href="index.html#kontak">Kontak</a></li>
        </ul>
    </div>
  </div>

  <div id="cartOverlay" class="cart-overlay">
    <div class="cart-drawer">
        <div class="drawer-header"><h3>Pesanan Saya</h3><button class="overlay-close" id="cartClose">&times;</button></div>
        <div class="drawer-body"><div id="cartOrdersList"></div></div>
    </div>
  </div>

  <main>
    <section class="section event-detail">
      <div class="container event-layout">
        <article class="event-main">
          <div class="event-summary">
            <h2 id="eventTitle">Judul Event</h2>
            <p id="eventTagline" class="text-muted"></p>
            <ul class="event-meta">
                <li><i class="fa-regular fa-calendar"></i> <span id="eventDate"></span></li>
                <li><i class="fa-solid fa-location-dot"></i> <span id="eventLocation"></span></li>
            </ul>
            <hr>
            <h3>Deskripsi</h3>
            <p id="eventDescription">Memuat deskripsi...</p>
            
            <div id="eventHighlightsBlock" class="event-block">
                <h3>Highlight</h3>
                <ul id="eventHighlights" class="bullet-list"></ul>
            </div>
          </div>
        </article>

        <aside class="event-sidebar">
          <div class="booking-card">
            <div class="price-tag">
              <span class="label">Harga Tiket</span>
              <span id="eventPrice" class="price-value">Rp 0</span>
            </div>

            <form id="paymentForm" class="payment-form">
              <h4>Pendaftaran Online</h4>
              <input type="hidden" name="ticketType" value="regular">
              
              <label class="label">Nama Lengkap</label>
              <input type="text" class="input" name="name" placeholder="Nama lengkap" required>
              
              <label class="label">Email (Gmail)</label>
              <input type="email" class="input" name="email" placeholder="nama@gmail.com" required>
              
              <label class="label">No. WhatsApp</label>
              <input type="tel" class="input" name="phone" placeholder="08xxxxxxxxxx" required>
              
              <p class="label">Metode Pembayaran</p>
              <div class="method-grid">
                  <button type="button" class="method-btn active" data-method="qris">QRIS</button>
                  <button type="button" class="method-btn" data-method="va" data-bank="bca">BCA</button>
                  <button type="button" class="method-btn" data-method="va" data-bank="mandiri">Mandiri</button>
              </div>

              <button class="btn btn-primary btn-full" type="submit" id="payNowBtn">Buat Tagihan</button>
            </form>
            
            <div id="paymentResult" class="payment-result hidden"></div>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <div id="loginModal" class="modal" aria-hidden="true" role="dialog" style="display: none;">
    <div class="modal-overlay" data-close="true"></div>
    <div class="modal-dialog">
      <button class="modal-close" id="closeModalBtn" data-close="true" type="button"><i class="fa-solid fa-xmark"></i></button>
      
      <div class="modal-header">
        <h3>Selamat Datang</h3>
        <p class="modal-sub">Login untuk melanjutkan</p>
      </div>

      <div class="modal-body">
        <button class="btn btn-google" type="button" id="googleLoginBtn">
          <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" width="20" alt="G"> 
          Login dengan Google
        </button>

        <div class="divider"><span>atau</span></div>

        <form id="loginForm">
          <label class="label">Email</label>
          <input class="input" type="email" name="email" placeholder="Email" required />
          <label class="label">Password</label>
          <input class="input" type="password" name="password" placeholder="Password" required />
          <button class="btn btn-primary btn-login-submit" type="submit">Login</button>
        </form>
        </div>
    </div>
  </div>

  <script src="js/home_page.js"></script>
  <script>window.__API_BASE_URL__ = "https://ketenangan-jiwa.vercel.app/api";</script>
  
  <script type="module" src="js/event_detail.js"></script>
  <script type="module" src="js/auth.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const pForm = document.getElementById('paymentForm');
      if (pForm) {
        pForm.addEventListener('submit', function(e) {
          // Cek apakah user sudah login di Firebase (cek localStorage)
          const isUser = Object.keys(localStorage).some(k => k.startsWith('firebase:authUser'));
          
          if (!isUser) {
            // JIKA BELUM LOGIN: Stop proses, munculkan modal
            e.preventDefault();
            e.stopImmediatePropagation();
            
            const modal = document.getElementById('loginModal');
            if (modal) {
              modal.classList.add('open');
              modal.style.display = 'block';
              alert("Silakan login terlebih dahulu untuk membuat tagihan.");
              
              // Simpan tanda agar setelah login bisa auto-klik (opsional)
              sessionStorage.setItem('pendingSubmit', 'true');
            }
          }
          // JIKA SUDAH LOGIN: Biarkan script event_detail.js bekerja
        }, true); 
      }
    });
  </script>
</body>
</html>